# ğŸ“‚ í”„ë¡œì íŠ¸ í˜„í™© ë³´ê³ ì„œ: JHë°”ì´ì˜¤íŒœ í…œí”Œë¦¿ ê°œë°œ í”„ë¡œì íŠ¸

> **ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ì˜ ë°©í–¥ì„±ê³¼ ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹´ê³  ìˆëŠ” "ë§ˆìŠ¤í„° ì¸ê³„ì¥"ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì„¸ì…˜ ì‹œì‘ ì‹œ ë°˜ë“œì‹œ ì´ íŒŒì¼ì„ ì •ë…í•˜ê³  ì—…ë¬´ë¥¼ ì‹œì‘í•˜ì‹­ì‹œì˜¤.**

---

## 1. í”„ë¡œì íŠ¸ í•µì‹¬ ëª©í‘œ (Core Objectives)
ë³¸ í”„ë¡œì íŠ¸ëŠ” ë‹¨ì¼ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ë‹¤ì–‘í•œ ì•„ì´ë””ì–´ë¥¼ ì¦‰ì‹œ ê²€ì¦í•  ìˆ˜ ìˆëŠ” ì†Œí”„íŠ¸ì›¨ì–´ í…œí”Œë¦¿(í”„ë ˆì„ì›Œí¬)ì„ êµ¬ì¶•**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ğŸš© Two-Track ì „ëµ
1.  **Track 1. ë²„í‹°ì»¬ ì»¤ë®¤ë‹ˆí‹° í…œí”Œë¦¿ (ê°œë°œ ì™„ë£Œ - Beta)**
    *   **ëª©í‘œ:** íŠ¹ì • ê´€ì‹¬ì‚¬(Vertical)ë¥¼ ê°€ì§„ ì‚¬ëŒë“¤ì„ ëª¨ì•„ ì‹œì¥ì„±ì„ ê²€ì¦í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹° êµ¬ì¶•ìš© í…œí”Œë¦¿.
    *   **êµ¬ì¡°:** `ììœ ê²Œì‹œíŒ` + `ê°¤ëŸ¬ë¦¬` + `ê³µì§€ì‚¬í•­` 3ë‹¨ ë¶„ë¦¬í˜• ì•„í‚¤í…ì²˜.
    *   **ìƒíƒœ:** í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ (ê¸€ì“°ê¸°, ëŒ“ê¸€, ì¡°íšŒìˆ˜, ì´ë¯¸ì§€, ì‚­ì œ ê¶Œí•œ ë“±).
2.  **Track 2. ê´‘ê³  ìˆ˜ìµí˜• ì½˜í…ì¸  í…œí”Œë¦¿ (í–¥í›„ ì˜ˆì •)**
    *   **ëª©í‘œ:** ì‚¬ì£¼, ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ë“± íŠ¸ë˜í”½ ê¸°ë°˜ ê´‘ê³  ìˆ˜ìµ ì°½ì¶œ ëª¨ë¸.

---

## 2. ê°œë°œ ì™„ë£Œ ë‚´ì—­ (Feature Complete)
**ì‘ì„±ì¼:** 2026ë…„ 1ì›” 6ì¼
**ìƒíƒœ:** ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ ë° ì•ˆì •í™” (DB/UI/Logic ì—°ë™ 100%)

### âœ… êµ¬í˜„ëœ í…œí”Œë¦¿ ëª¨ë“ˆ (Modules)
1.  **ê²Œì‹œíŒ ì‹œìŠ¤í…œ (Board System) - [ì™„ë£Œ]**
    *   **ë¬¼ë¦¬ì  ë¶„ë¦¬:** `free` (í…ìŠ¤íŠ¸), `gallery` (ì´ë¯¸ì§€), `notice` (ê³µì§€) í…Œì´ë¸”ì„ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ê°„ì„­ ë°©ì§€.
    *   **ë¡œì§ í†µí•©:** `useBoard(type)` ì»´í¬ì €ë¸” í•˜ë‚˜ë¡œ 3ê°€ì§€ ê²Œì‹œíŒì„ ëª¨ë‘ ì œì–´í•˜ëŠ” ë‹¤í˜•ì„±(Polymorphism) êµ¬í˜„.
    *   **ì¡°íšŒìˆ˜:** RPC í•¨ìˆ˜(`increment_view_count`)ë¥¼ í†µí•´ ì¡°íšŒìˆ˜ ìë™ ì¦ê°€ êµ¬í˜„.
    *   **ê¶Œí•œ ê´€ë¦¬:**
        *   ê²Œì‹œê¸€ ì‚­ì œ: ë³¸ì¸ë§Œ ê°€ëŠ¥.
        *   ëŒ“ê¸€ ì‚­ì œ: **ëŒ“ê¸€ ì‘ì„±ì** ë˜ëŠ” **ê²Œì‹œê¸€ ì£¼ì¸** ë‘˜ ë‹¤ ê°€ëŠ¥ (ê´€ë¦¬ ê¶Œí•œ).
        *   **Cascade:** ê²Œì‹œê¸€ ì‚­ì œ ì‹œ ê´€ë ¨ ëŒ“ê¸€ ìë™ ì‚­ì œ.
    *   **ìŠ¤í† ë¦¬ì§€:** ê°¤ëŸ¬ë¦¬ ê¸€ ì‚­ì œ ì‹œ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼ë„ Supabase Storageì—ì„œ ìë™ ì‚­ì œ.

2.  **ì¸ì¦ ì‹œìŠ¤í…œ (Auth) - [ì™„ë£Œ]**
    *   Supabase Auth ì—°ë™ (ì´ë©”ì¼/êµ¬ê¸€).
    *   íšŒì›ê°€ì… ì‹œ `public.profiles` í…Œì´ë¸”ì— ìœ ì € ì •ë³´ ìë™ ë™ê¸°í™” (Trigger).
    *   UI: ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ í—¤ë” ë³€ê²½, ê°•ì œ ë¡œë”© ë°©ì§€(`ClientOnly`).

3.  **UI/UX - [ì™„ë£Œ]**
    *   **Lazy Loading:** ë°ì´í„° ë¡œë”© ì¤‘ì—ë„ í˜ì´ì§€ ì´ë™ì´ ë©ˆì¶”ì§€ ì•ŠìŒ.
    *   **ë°˜ì‘í˜• ê¶Œí•œ ì²´í¬:** ë¡œê·¸ì¸ ì •ë³´ ë¡œë“œ ì‹œì ì— ë§ì¶° 'ì‚­ì œ' ë²„íŠ¼ ìë™ ë…¸ì¶œ (`computed`).
    *   **ê°¤ëŸ¬ë¦¬ ë·°:** ì´ë¯¸ì§€ ì¤‘ì‹¬ì˜ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ë° ìƒì„¸ í˜ì´ì§€ êµ¬í˜„.

---

## 3. ğŸš¨ [í•„ìˆ˜] ë§ˆìŠ¤í„° DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (Master Init SQL)
**ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ì— ì´ í…œí”Œë¦¿ì„ ë°°í¬í•  ë•Œ, ì•„ë˜ SQLì„ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.**

```sql
-- ğŸ› ï¸ 1. ì´ˆê¸°í™” (ê¸°ì¡´ í…Œì´ë¸” ë° ê°ì²´ ì‚­ì œ)
DROP TABLE IF EXISTS public.free_comments CASCADE;
DROP TABLE IF EXISTS public.gallery_comments CASCADE;
DROP TABLE IF EXISTS public.free_posts CASCADE;
DROP TABLE IF EXISTS public.gallery_posts CASCADE;
DROP TABLE IF EXISTS public.notice_posts CASCADE;
DROP TABLE IF EXISTS public.profiles CASCADE;
DROP FUNCTION IF EXISTS public.handle_new_user CASCADE;
DROP FUNCTION IF EXISTS public.increment_view_count CASCADE;

-- ğŸ› ï¸ 2. í”„ë¡œí•„ í…Œì´ë¸” (Auth ì—°ë™)
CREATE TABLE public.profiles (
  id uuid NOT NULL REFERENCES auth.users ON DELETE CASCADE,
  email text NOT NULL,
  nickname text,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  PRIMARY KEY (id)
);
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Public profiles are viewable by everyone." ON profiles FOR SELECT USING (true);
CREATE POLICY "Users can insert their own profile." ON profiles FOR INSERT WITH CHECK (auth.uid() = id);
CREATE POLICY "Users can update own profile." ON profiles FOR UPDATE USING (auth.uid() = id);

-- ğŸ› ï¸ 3. ê²Œì‹œíŒ í…Œì´ë¸” ìƒì„±
-- (1) ììœ ê²Œì‹œíŒ
CREATE TABLE public.free_posts (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  user_id uuid REFERENCES public.profiles(id) NOT NULL,
  nickname text NOT NULL,
  view_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);
-- (2) ê°¤ëŸ¬ë¦¬
CREATE TABLE public.gallery_posts (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  image_url text NOT NULL,
  user_id uuid REFERENCES public.profiles(id) NOT NULL,
  nickname text NOT NULL,
  view_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);
-- (3) ê³µì§€ì‚¬í•­
CREATE TABLE public.notice_posts (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  user_id uuid REFERENCES public.profiles(id) NOT NULL,
  nickname text NOT NULL,
  view_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- ğŸ› ï¸ 4. ëŒ“ê¸€ í…Œì´ë¸” ìƒì„± (Cascade ì‚­ì œ ì ìš©)
CREATE TABLE public.free_comments (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id bigint REFERENCES public.free_posts(id) ON DELETE CASCADE NOT NULL,
  content text NOT NULL,
  user_id uuid REFERENCES public.profiles(id) NOT NULL,
  nickname text NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);
CREATE TABLE public.gallery_comments (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id bigint REFERENCES public.gallery_posts(id) ON DELETE CASCADE NOT NULL,
  content text NOT NULL,
  user_id uuid REFERENCES public.profiles(id) NOT NULL,
  nickname text NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- ğŸ› ï¸ 5. RLS ë³´ì•ˆ ì •ì±… ì„¤ì •
ALTER TABLE public.free_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.gallery_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.notice_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.free_comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.gallery_comments ENABLE ROW LEVEL SECURITY;

-- [ì¡°íšŒ ì •ì±…]
CREATE POLICY "Public read free" ON free_posts FOR SELECT USING (true);
CREATE POLICY "Public read gallery" ON gallery_posts FOR SELECT USING (true);
CREATE POLICY "Public read notice" ON notice_posts FOR SELECT USING (true);
CREATE POLICY "Public read free_comments" ON free_comments FOR SELECT USING (true);
CREATE POLICY "Public read gallery_comments" ON gallery_comments FOR SELECT USING (true);

-- [ì‘ì„± ì •ì±…]
CREATE POLICY "User write free" ON free_posts FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "User write gallery" ON gallery_posts FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "User write notice" ON notice_posts FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "User write free_comments" ON free_comments FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "User write gallery_comments" ON gallery_comments FOR INSERT WITH CHECK (auth.role() = 'authenticated');

-- [ì‚­ì œ ì •ì±… - ê²Œì‹œê¸€]
CREATE POLICY "Owner delete free" ON free_posts FOR DELETE USING (auth.uid() = user_id);
CREATE POLICY "Owner delete gallery" ON gallery_posts FOR DELETE USING (auth.uid() = user_id);
CREATE POLICY "Owner delete notice" ON notice_posts FOR DELETE USING (auth.uid() = user_id);

-- [ì‚­ì œ ì •ì±… - ëŒ“ê¸€ (ë³¸ì¸ or ê²Œì‹œê¸€ ì£¼ì¸)]
CREATE POLICY "Super delete free_comments" ON free_comments FOR DELETE USING (
  auth.uid() = user_id OR EXISTS (SELECT 1 FROM free_posts WHERE id = post_id AND user_id = auth.uid())
);
CREATE POLICY "Super delete gallery_comments" ON gallery_comments FOR DELETE USING (
  auth.uid() = user_id OR EXISTS (SELECT 1 FROM gallery_posts WHERE id = post_id AND user_id = auth.uid())
);

-- ğŸ› ï¸ 6. Storage ì„¤ì •
INSERT INTO storage.buckets (id, name, public) VALUES ('images', 'images', true) ON CONFLICT (id) DO NOTHING;
DROP POLICY IF EXISTS "Give public access to images" ON storage.objects;
CREATE POLICY "Give public access to images" ON storage.objects FOR SELECT USING ( bucket_id = 'images' );
DROP POLICY IF EXISTS "Enable upload for authenticated users" ON storage.objects;
CREATE POLICY "Enable upload for authenticated users" ON storage.objects FOR INSERT TO authenticated WITH CHECK ( bucket_id = 'images' );
DROP POLICY IF EXISTS "Enable delete for users" ON storage.objects;
CREATE POLICY "Enable delete for users" ON storage.objects FOR DELETE TO authenticated USING ( bucket_id = 'images' );

-- ğŸ› ï¸ 7. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION increment_view_count(table_name text, row_id bigint) RETURNS void AS $$
BEGIN
  EXECUTE format('UPDATE public.%I SET view_count = view_count + 1 WHERE id = $1', table_name) USING row_id;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE OR REPLACE FUNCTION public.handle_new_user() RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, email, nickname) VALUES (new.id, new.email, split_part(new.email, '@', 1));
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created AFTER INSERT ON auth.users FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();

-- (Backfill)
INSERT INTO public.profiles (id, email, nickname)
SELECT id, email, split_part(email, '@', 1) FROM auth.users WHERE id NOT IN (SELECT id FROM public.profiles);
```

---

## 4. ê¸°ìˆ  ìŠ¤íƒ ë° ì˜ì‚¬ ê²°ì • (Technical Context)
1.  **TypeScript (`.ts`):** Nuxt 3ì˜ í‘œì¤€ ì–¸ì–´ë¡œ, ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ëŸ°íƒ€ì„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì±„íƒ (ì˜ˆ: `post` ê°ì²´ì˜ ì†ì„± ì ‘ê·¼ ë“±).
2.  **TailwindCSS:** ë¹ ë¥¸ UI ìŠ¤íƒ€ì¼ë§ì„ ìœ„í•´ ì‚¬ìš©.
3.  **Supabase:** Auth, Database, Storageë¥¼ í†µí•© ê´€ë¦¬í•˜ëŠ” BaaS.

### ğŸš§ í–¥í›„ ê°œì„  ê³¼ì œ (Refactoring Recommendations)
*   **ì½”ë“œ ë¶„ë¦¬:** í˜„ì¬ `useBoard.ts`ê°€ ëª¨ë“  ê²Œì‹œíŒ ë¡œì§ì„ ë‹´ë‹¹í•˜ì—¬ ë¹„ëŒ€í•¨.
    *   `useFreeBoard.ts`, `useGallery.ts` ë“±ìœ¼ë¡œ ì—­í•  ë¶„ë¦¬ ê¶Œì¥.
    *   ë˜ëŠ” `composables/services/` í´ë” í•˜ìœ„ë¡œ ì´ë™í•˜ì—¬ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬.
*   **UI ì»´í¬ë„ŒíŠ¸í™”:** ìƒì„¸ í˜ì´ì§€(`[id].vue`)ì˜ ëŒ“ê¸€ ì„¹ì…˜ ë“± ë°˜ë³µë˜ëŠ” UIë¥¼ ë³„ë„ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•˜ì—¬ ì¬ì‚¬ìš©ì„± ì¦ëŒ€ í•„ìš”.

---

## 5. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì´ë ¥ (Troubleshooting Log)
**ê°œë°œ ì¤‘ ë°œìƒí–ˆë˜ ì£¼ìš” ì´ìŠˆì™€ í•´ê²° ë°©ë²•ì…ë‹ˆë‹¤.**

1.  **ë¡œë”© ë©ˆì¶¤ í˜„ìƒ:** `useAsyncData`ì˜ `lazy: true` ì˜µì…˜ê³¼ ì•ˆì „í•œ ì—ëŸ¬ í•¸ë“¤ë§(`try-catch`) ì ìš©ìœ¼ë¡œ í•´ê²°.
2.  **ì‚­ì œ ë²„íŠ¼ ë¯¸ë…¸ì¶œ:** `onMounted`ì—ì„œ `auth.getUser()`ë¡œ ìœ ì € ì •ë³´ë¥¼ ê°•ì œ ë¡œë“œí•˜ê³  `computed`ë¡œ ë°˜ì‘ì„± í™•ë³´.
3.  **ìŠ¤í† ë¦¬ì§€ ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨:** URL íŒŒì‹± ë¡œì§ ê°œì„  ë° Storage `DELETE` ì •ì±… ì¶”ê°€.
4.  **ë¼ìš°íŒ… ì¶©ëŒ:** `[...slug].vue` íŒŒì¼ ì‚­ì œë¡œ ì •ìƒ ë¼ìš°íŒ… ë³µêµ¬.